
// gallery.js
//
// Packt Publishing - Build a Network Application with Node
// Display images uploaded by the user

var fs = require("fs");

module.exports = function(req, res) {

  res.writeHead(200, { "Content-Type": "text/html" });

  // List uploaded images and their filenames
  fs.readdir("./img", function(err, files) {

    var html = "<p>Sorry, no images in the gallery.</p>";

    if (files.length) {
      html = "<h1>Image gallery</h1>";
      files.forEach(function(file) {
        if (/\.(jpeg|jpg|gif|png)$/.test(file)) {
          html += '<br/><img src="/img/' + file + '" width="640" height="480" /><br/>' + file + '<br/>';            
        }
      });
    }

    res.end(html);
  });
};