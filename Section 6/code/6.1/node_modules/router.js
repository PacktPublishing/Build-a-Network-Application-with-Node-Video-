
// router.js
//
// Packt Publishing - Build a Network Application with Node
// Router component for Connect middleware

var errUtil = require("err_util"),
  url = require("url");

module.exports = function() {

  var _routes = {
      "get": {
        "/": require("index")
      }
    },

    _router = function(req, res, next) {

      var parsedUrl = url.parse(req.url, true),
        pathname = parsedUrl.pathname,
        method = req.method.toLowerCase();

      // Normalize pathname by removing trailing slash
      if (pathname != "/" && pathname.lastIndexOf("/") == pathname.length-1) {
        pathname = pathname.substr(0, pathname.length-1);
      }

      if (typeof _routes[method] !== "undefined" && typeof _routes[method][pathname] == "function") {
        _routes[method][pathname](req, res, next);
        return;
      }

      next(errUtil.report(null, res, 404, "Page not found: " + req.url));

    };

  return _router;
};